<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Road map – Flow</title>
<link rel="stylesheet" href="assets/css/style.css">
<style>
  .flow{background:#0b1220;border:1px solid #334155;border-radius:1rem;padding:1rem;overflow:auto}
  .flow svg{min-width:980px; min-height:520px;}
  .node{cursor:pointer}
  .ring text{font-size:12px; fill:#e5e7eb}
</style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <h1><img src="assets/img/logo.svg" alt="" style="vertical-align:middle;margin-right:.5rem"/>Road map – Flow</h1>
      <nav>
        <a class="navlink" href="index.html">Accueil</a>
        <a class="navlink" href="edu.html">Sciences de l’éducation</a>
        <a class="navlink" href="oulpan.html">Oulpan hébreu</a>
        <a class="navlink" href="vae.html">VAE Paris 8</a>
        <a class="navlink" href="master.html">Candidature Master (HUJI)</a>
        <a class="navlink" href="ong.html">Projet ONG</a>
        <a class="navlink" href="sport.html">Sport & santé</a>
        <a class="navlink" href="english.html">Anglais</a>
        <a class="navlink" href="car.html">Permis voiture</a>
        <a class="navlink" href="moto.html">Permis moto</a>
        <a class="navlink" href="photo.html">Photographie</a>
        <a class="navlink" href="guitar.html">Guitare</a>
        <a class="navlink" href="dj.html">DJ / Platines</a>
        <a class="btn" id="exportCSV">Exporter progression (CSV)</a>
              <a class="navlink {timeline}" href="timeline.html">Timeline</a>
      </nav>
    </div>
  </header>
  <main>
    <div class="subtitle">Vue “carte” des dépendances — clique un bloc pour ouvrir la page correspondante.</div>
    <div class="flow">
      <svg viewBox="0 0 1000 560" id="flowSvg">
        <defs>
          <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto">
            <path d="M0,0 L0,6 L9,3 z" fill="#94a3b8"></path>
          </marker>
        </defs>
        <!-- Nodes (rect + progress ring) -->
        <!-- Row 1 -->
        <g class="node" data-href="vae.html">
          <rect x="30" y="40" width="190" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="125" y="75" text-anchor="middle" fill="#e5e7eb">VAE Paris 8</text>
          <g class="ring" transform="translate(30,40)"></g>
        </g>
        <g class="node" data-href="edu.html">
          <rect x="260" y="40" width="220" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="370" y="75" text-anchor="middle" fill="#e5e7eb">Licence (L1→L3)</text>
          <g class="ring" transform="translate(260,40)"></g>
        </g>
        <g class="node" data-href="master.html">
          <rect x="520" y="40" width="220" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="630" y="75" text-anchor="middle" fill="#e5e7eb">Master HUJI</text>
          <g class="ring" transform="translate(520,40)"></g>
        </g>
        <!-- Row 2 -->
        <g class="node" data-href="oulpan.html">
          <rect x="30" y="180" width="220" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="140" y="215" text-anchor="middle" fill="#e5e7eb">Oulpan (Alef→Vav)</text>
          <g class="ring" transform="translate(30,180)"></g>
        </g>
        <g class="node" data-href="english.html">
          <rect x="290" y="180" width="220" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="400" y="215" text-anchor="middle" fill="#e5e7eb">Anglais (IELTS/TOEFL)</text>
          <g class="ring" transform="translate(290,180)"></g>
        </g>
        <g class="node" data-href="ong.html">
          <rect x="550" y="180" width="190" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="645" y="215" text-anchor="middle" fill="#e5e7eb">Projet ONG</text>
          <g class="ring" transform="translate(550,180)"></g>
        </g>
        <!-- Row 3 -->
        <g class="node" data-href="car.html">
          <rect x="30" y="320" width="190" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="125" y="355" text-anchor="middle" fill="#e5e7eb">Permis voiture</text>
          <g class="ring" transform="translate(30,320)"></g>
        </g>
        <g class="node" data-href="moto.html">
          <rect x="260" y="320" width="190" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="355" y="355" text-anchor="middle" fill="#e5e7eb">Permis moto</text>
          <g class="ring" transform="translate(260,320)"></g>
        </g>
        <g class="node" data-href="sport.html">
          <rect x="490" y="320" width="190" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="585" y="355" text-anchor="middle" fill="#e5e7eb">Sport & santé</text>
          <g class="ring" transform="translate(490,320)"></g>
        </g>
        <!-- Row 4 -->
        <g class="node" data-href="photo.html">
          <rect x="30" y="460" width="190" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="125" y="495" text-anchor="middle" fill="#e5e7eb">Photographie</text>
          <g class="ring" transform="translate(30,460)"></g>
        </g>
        <g class="node" data-href="guitar.html">
          <rect x="260" y="460" width="190" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="355" y="495" text-anchor="middle" fill="#e5e7eb">Guitare</text>
          <g class="ring" transform="translate(260,460)"></g>
        </g>
        <g class="node" data-href="dj.html">
          <rect x="490" y="460" width="190" height="60" rx="12" fill="#0b1220" stroke="#334155"/>
          <text x="585" y="495" text-anchor="middle" fill="#e5e7eb">DJ / Platines</text>
          <g class="ring" transform="translate(490,460)"></g>
        </g>

        <!-- Arrows -->
        <g stroke="#94a3b8" stroke-width="2" fill="none" marker-end="url(#arrow)">
          <line x1="220" y1="70" x2="260" y2="70"/>
          <line x1="480" y1="70" x2="520" y2="70"/>
          <line x1="140" y1="100" x2="140" y2="180"/>
          <line x1="250" y1="210" x2="290" y2="210"/>
          <line x1="510" y1="210" x2="550" y2="210"/>
        </g>
      </svg>
    </div>
  </main>
  <footer>Conçu pour Ruben • © 2025</footer>

  <script type="module">
    import { exportAllCSV } from './assets/js/app.js';
    document.getElementById('exportCSV').addEventListener('click', ()=>{
      exportAllCSV('progression.csv',[
        {key:'edu_progress', label:'Education'},
        {key:'oulpan_progress', label:'Oulpan'},
        {key:'vae_progress', label:'VAE'},
        {key:'master_progress', label:'Master'},
        {key:'ong_progress', label:'ONG'},
        {key:'sport_progress', label:'Sport'},
        {key:'english_progress', label:'English'},
        {key:'car_progress', label:'Permis voiture'},
        {key:'moto_progress', label:'Permis moto'},
        {key:'photo_progress', label:'Photo'},
        {key:'guitar_progress', label:'Guitare'},
        {key:'dj_progress', label:'DJ'}
      ]);
    });

    // Progress rings for each node based on localStorage namespaces
    const namespaces = [
      {ns:'vae_progress', x:30, y:40, w:190, h:60},
      {ns:'edu_progress', x:260, y:40, w:220, h:60},
      {ns:'master_progress', x:520, y:40, w:220, h:60},
      {ns:'oulpan_progress', x:30, y:180, w:220, h:60},
      {ns:'english_progress', x:290, y:180, w:220, h:60},
      {ns:'ong_progress', x:550, y:180, w:190, h:60},
      {ns:'car_progress', x:30, y:320, w:190, h:60},
      {ns:'moto_progress', x:260, y:320, w:190, h:60},
      {ns:'sport_progress', x:490, y:320, w:190, h:60},
      {ns:'photo_progress', x:30, y:460, w:190, h:60},
      {ns:'guitar_progress', x:260, y:460, w:190, h:60},
      {ns:'dj_progress', x:490, y:460, w:190, h:60},
    ];

    function pct(ns){
      try{ const m = JSON.parse(localStorage.getItem(ns)||"{}"); const v = Object.values(m); if(!v.length) return 0; const d=v.filter(Boolean).length; return Math.round(d*100/v.length); }
      catch(e){ return 0; }
    }

    const svg = document.getElementById('flowSvg');
    function ring(g, percent){
      const R = 24, Cx = 12, Cy = -12; // will translate to corner
      const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
      c.setAttribute('cx', 12); c.setAttribute('cy', 12); c.setAttribute('r', R.toString());
      c.setAttribute('stroke','#334155'); c.setAttribute('stroke-width','6'); c.setAttribute('fill','none');
      const a = document.createElementNS('http://www.w3.org/2000/svg','circle');
      a.setAttribute('cx', 12); a.setAttribute('cy', 12); a.setAttribute('r', R.toString());
      a.setAttribute('stroke','url(#grad)'); a.setAttribute('stroke-width','6'); a.setAttribute('fill','none');
      a.setAttribute('stroke-dasharray', `${2*Math.PI*R}`);
      a.setAttribute('stroke-dashoffset', `${2*Math.PI*R*(1-percent/100)}`);
      a.setAttribute('transform','rotate(-90 12 12)');
      const t = document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x','12'); t.setAttribute('y','16'); t.setAttribute('text-anchor','middle'); t.textContent = percent+'%';
      g.appendChild(c); g.appendChild(a); g.appendChild(t);
    }
    // gradient def
    const defs = document.createElementNS('http://www.w3.org/2000/svg','defs');
    const lg = document.createElementNS('http://www.w3.org/2000/svg','linearGradient'); lg.setAttribute('id','grad'); lg.setAttribute('x1','0'); lg.setAttribute('x2','1');
    const s1 = document.createElementNS('http://www.w3.org/2000/svg','stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color','#22d3ee');
    const s2 = document.createElementNS('http://www.w3.org/2000/svg','stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color','#a78bfa');
    lg.appendChild(s1); lg.appendChild(s2); defs.appendChild(lg); svg.appendChild(defs);

    // Place rings in each .ring group
    const rings = svg.querySelectorAll('.ring');
    rings.forEach((gEl, i)=>{
      const ns = namespaces[i]?.ns || 'edu_progress';
      ring(gEl, pct(ns));
    });

    // Node click
    svg.querySelectorAll('.node').forEach(n=>{
      n.addEventListener('click', ()=>{ const href = n.getAttribute('data-href'); if(href) window.location.href = href; });
    });
  </script>
</body>
</html>
