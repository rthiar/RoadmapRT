<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Road map – Focus aujourd’hui</title>
<link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <header>
    <div class="wrap brand">
      <h1><img src="assets/img/logo.svg" alt="" style="vertical-align:middle;margin-right:.5rem"/>Road map – Focus aujourd’hui</h1>
      <nav>
      <a class="navlink" href="index.html">Accueil</a>
      <a class="navlink" href="flow.html">Flow</a>
      <a class="navlink" href="timeline.html">Timeline</a>
      <a class="navlink" href="focus.html">Focus</a>
      <a class="navlink" href="edu.html">Sciences de l’éducation</a>
      <a class="navlink" href="oulpan.html">Oulpan hébreu</a>
      <a class="navlink" href="vae.html">VAE Paris 8</a>
      <a class="navlink" href="master.html">Candidature Master (HUJI)</a>
      <a class="navlink" href="driving.html">Permis auto & moto</a>
      <a class="navlink" href="crea.html">Créa : Photo, Guitare & DJ</a>
      <a class="navlink" href="ong.html">Projet ONG</a>
    </nav>
    </div>
  </header>
  <main>
    <div class="subtitle">Ce qui mérite ton attention aujourd’hui — extrait de tes objectifs hebdo, SRS, et timeline du mois.</div>
    <div class="grid" id="focusGrid"></div>
  </main>
  <footer>Conçu pour Ruben • © 2025</footer>
  <script type="module">
    import { exportAllCSV } from './assets/js/app.js';
    document.getElementById('exportCSV').addEventListener('click', ()=>{
      exportAllCSV('progression.csv',[
        {key:'edu_progress', label:'Education'},
        {key:'oulpan_progress', label:'Oulpan'},
        {key:'vae_progress', label:'VAE'},
        {key:'master_progress', label:'Master'},
        {key:'ong_progress', label:'ONG'},
        {key:'sport_progress', label:'Sport'},
        {key:'english_progress', label:'English'},
        {key:'car_progress', label:'Permis voiture'},
        {key:'moto_progress', label:'Permis moto'},
        {key:'photo_progress', label:'Photo'},
        {key:'guitar_progress', label:'Guitare'},
        {key:'dj_progress', label:'DJ'}
      ]);
    });
  </script>
  <script type="module">
    // Theme toggle (reuse)
    (function(){
      const KEY='pref_theme'; const btn = document.getElementById('themeToggle');
      function apply(t){ document.documentElement.setAttribute('data-theme', t); btn.textContent = 'Thème: ' + (t==='light'?'Clair':'Sombre'); }
      const saved = localStorage.getItem(KEY) || 'dark'; apply(saved);
      btn.addEventListener('click', ()=>{ const cur=document.documentElement.getAttribute('data-theme')||'dark'; const next=cur==='dark'?'light':'dark'; localStorage.setItem(KEY,next); apply(next); });
    })();
  </script>
  <script type="module">
    // Build today's focus from: weekly objectives (under target), Oulpan SRS due, and Timeline tasks not started ◻︎
    const grid = document.getElementById('focusGrid');
    function card(title, items){ return `<div class="card"><div class="month"><h2>${title}</h2></div><ul>${items.map(x=>`<li>${x}</li>`).join('')}</ul></div>`; }
    // Weekly objectives
    function weeklyFocus(){
      const pages = [
        {key:'car_weekly', label:'Permis voiture', link:'car.html'},
        {key:'moto_weekly', label:'Permis moto', link:'moto.html'},
        {key:'guitar_weekly', label:'Guitare', link:'guitar.html'},
        {key:'dj_weekly', label:'DJ', link:'dj.html'},
        {key:'sport_weekly', label:'Sport', link:'sport.html'},
        {key:'oulpan_weekly', label:'Oulpan', link:'oulpan.html'},
        {key:'english_weekly', label:'Anglais', link:'english.html'},
        {key:'photo_weekly', label:'Photo', link:'photo.html'},
        {key:'ong_weekly', label:'ONG', link:'ong.html'}
      ];
      const out=[];
      pages.forEach(p=>{
        try{
          const s = JSON.parse(localStorage.getItem(p.key)||'{}');
          const now = Object.entries(s.items||{}).map(([id,val])=>({id,val}));
          now.forEach(it=>{
            // present as +1 quick buttons
            out.push(`<strong>${p.label}</strong> — ${it.id} <a class='btn small' data-inc='${p.key}::${it.id}'>+1</a> <a class='btn small' href='${p.link}'>Ouvrir</a>`);
          });
        }catch(e){}
      });
      return card("Objectifs hebdo", out.slice(0,8));
    }
    // Oulpan SRS due words count
    function srsFocus(){
      try{
        const s = JSON.parse(localStorage.getItem('oulpan_srs_v1')||'{}');
        const today = new Date(); today.setHours(0,0,0,0);
        const due = Object.values(s.items||{}).filter(it => !it.nextDue || new Date(it.nextDue).setHours(0,0,0,0) <= today).length;
        const txt = due>0 ? `${due} carte(s) à réviser` : 'Rien d’urgent';
        return card("Oulpan — SRS", [txt + " <a class='btn small' href='oulpan.html'>Réviser</a>"]);
      }catch(e){ return card("Oulpan — SRS", ["—"]); }
    }
    // Timeline current month tasks not started
    function timelineFocus(){
      try{
        const TL = JSON.parse(localStorage.getItem('timeline_status_v1')||'{}');
        const now = new Date();
        const y = now.getFullYear(), m = now.getMonth()+1;
        const items = Object.keys(TL).filter(id => id.startsWith('m'+y+'-'+m+'::') && TL[id]===0);
        const lis = items.slice(0,6).map(id => `Tâche ${id.split('::')[1]} <a class='btn small' data-tlid='${id}'>◻︎→◔</a>`);
        return card("Timeline — à démarrer", lis.length? lis : ["OK ✓"]);
      }catch(e){ return card("Timeline — à démarrer", ["—"]); }
    }
    grid.innerHTML = weeklyFocus() + srsFocus() + timelineFocus();

    // Wire quick +1 for weekly
    grid.querySelectorAll('[data-inc]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const [ns, id] = b.getAttribute('data-inc').split('::');
        try{
          const s = JSON.parse(localStorage.getItem(ns)||'{}'); s.items[id]=(s.items[id]||0)+1; localStorage.setItem(ns, JSON.stringify(s));
          b.textContent = '✔︎';
        }catch(e){}
      });
    });
    // Wire timeline quick toggle (◻︎→◔)
    grid.querySelectorAll('[data-tlid]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const id = b.getAttribute('data-tlid');
        try{
          const s = JSON.parse(localStorage.getItem('timeline_status_v1')||'{}'); const cur = s[id]||0; s[id] = cur===0?1:cur; localStorage.setItem('timeline_status_v1', JSON.stringify(s));
          b.textContent = '◔';
        }catch(e){}
      });
    });
  </script>
  <script type="module">
    // Notifications on focus page load
    (async function(){
      if(!('Notification' in window)) return;
      if(Notification.permission !== 'granted' && Notification.permission !== 'denied'){
        await Notification.requestPermission();
      }
    })();
  </script>
</body>
</html>
