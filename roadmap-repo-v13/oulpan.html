<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Road map â€“ Oulpan hÃ©breu</title>
<link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <header>
    <div class="wrap brand">
      <h1><img src="assets/img/logo.svg" alt="" style="vertical-align:middle;margin-right:.5rem"/>Road map â€“ Oulpan hÃ©breu</h1>
      <nav>
        <a class="btn small" id="themeToggle">ThÃ¨me: Sombre</a>

    <a class="navlink " href="index.html">Accueil</a>
    <a class="navlink " href="edu.html">Sciences de lâ€™Ã©ducation</a>
    <a class="navlink active" href="oulpan.html">Oulpan hÃ©breu</a>
    <a class="navlink " href="vae.html">VAE Paris 8</a>
    <a class="navlink " href="master.html">Candidature Master (HUJI)</a>
    <a class="navlink " href="ong.html">Projet ONG</a>
    <a class="navlink " href="sport.html">Sport & santÃ©</a>
    <a class="navlink " href="english.html">Anglais</a>
    <a class="btn" id="exportCSV">Exporter progression (CSV)</a>
        <a class="navlink {car}" href="car.html">Permis voiture</a>
    <a class="navlink {moto}" href="moto.html">Permis moto</a>
    <a class="navlink {photo}" href="photo.html">Photographie</a>
    <a class="navlink {guitar}" href="guitar.html">Guitare</a>
    <a class="navlink {dj}" href="dj.html">DJ / Platines</a>
    <a class="navlink {flow}" href="flow.html">Flow</a>
        <a class="navlink {timeline}" href="timeline.html">Timeline</a>
              <a class="navlink {focus}" href="focus.html">Focus</a>
      </nav>
    </div>
  </header>
  <main>
  

<div class="card">
  <div class="month"><h2>Objectifs hebdo</h2><span class="badge">Reset auto lundi</span></div>
  <div class="section">Suivi</div>
  <ul id="weeklyList"></ul>
  <div class="card-tools">
    <a class="btn small" id="weeklyReset">Remettre Ã  zÃ©ro (cette semaine)</a>
  </div>
</div>


<div id="weeklyBanner" class="card" style="border:1px dashed #f59e0b; background:#0b1220; margin-bottom:1rem;">
  <div class="month"><h2>Rappel hebdo</h2><span class="badge">Dimanche</span></div>
  <div class="muted" id="weeklyBannerText">Tout est OK pour lâ€™instant.</div>
</div>

<div class="subtitle">Alef â†’ Vav â€¢ sans translittÃ©ration â€¢ textes sans niqqud â€¢ accent israÃ©lien â€¢ 4â€“5 h/sem + SRS 10â€“15 min/jour</div>
<div class="toolbar">
  <input class="search" type="search" placeholder="Rechercher (ex: paal, hifil, binyan, rdv, budgetâ€¦)">
  <a class="btn expand">Tout ouvrir</a>
  <a class="btn collapse">Tout fermer</a>
  <a class="btn reset">RÃ©initialiser progression</a>
  <a class="btn print">Exporter en PDF</a>
</div>
<div class="toolbar">
  <div style="flex:1 1 320px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.35rem;">
      <span>Progression globale</span>
      <strong class="globalPct">0%</strong>
    </div>
    <div class="barwrap"><div class="bar globalBar" style="width:0%"></div></div>
  </div>
</div>

<div class="card">
  <div class="month"><h2>RÃ©visions du jour (SRS)</h2><span class="badge" id="srsCount">0 cartes</span></div>
  <div class="muted">Objectif : 10â€“15 cartes/jour (J+1, J+3, J+7, J+21, J+60)</div>
  <div class="section">Ã€ faire aujourdâ€™hui</div>
  <ul id="srsList"></ul>
  <div class="card-tools">
    <a class="btn small" id="srsGenerate">GÃ©nÃ©rer 10 cartes (exemple)</a>
    <a class="btn small" id="srsClear">Vider la liste</a>
  </div>
</div>


<div class="card">
  <div class="month"><h2>Ã‰diteur de vocab (JSON)</h2><span class="badge">Override local</span></div>
  <div class="muted">Modifie les listes (Ã©ducation / ONG / administratif). Sauvegarde locale (nâ€™Ã©crit pas le fichier) et prise en compte immÃ©diate par le SRS.</div>
  <div class="section">JSON</div>
  <textarea id="wordsJson" style="width:100%;min-height:180px;background:#0b1220;color:#e5e7eb;border:1px solid #334155;border-radius:.6rem;padding:.6rem;font-family:ui-monospace, SFMono-Regular, Menlo, monospace;"></textarea>
  <div class="card-tools">
    <a class="btn small" id="loadFile">Charger fichier</a> <input type="file" id="jsonFileInput" accept=".json" style="display:inline-block">
    <a class="btn small" id="saveOverride">Sauvegarder (local)</a>
    <a class="btn small" id="resetOverride">RÃ©initialiser</a>
    <a class="btn small" id="downloadJson">TÃ©lÃ©charger JSON</a>
  </div>
</div>


<div class="grid" id="oulpanGrid"></div>

<script type="module">
  import { initChecklist } from './assets/js/app.js';

  const OULPAN = [
    { title:"Alef (A1)", subtitle:"Bases â€“ Ã©cole & jeunesse", units:[
      "1) Alphabet 1 (lecture initiale)",
      "2) Alphabet 2 (finales & fluiditÃ©)",
      "3) Se prÃ©senter (Ã©ducation/jeunesse)",
      "4) Verbes Paal â€“ prÃ©sent",
      "5) Centre/Ã‰cole (logistique)",
      "6) Groupes & consignes",
      "7) Famille / communautÃ© / fÃªtes",
      "8) Projet Alef"
    ]},
    { title:"Bet (A2)", subtitle:"Animation & organisation", units:[
      "1) PassÃ©/Futur Paal (planning)",
      "2) Hifil prÃ©sent (former, diriger)",
      "8) Projet Bet â€“ Brief bÃ©nÃ©vole"
    ]},
    { title:"Gimel (B1-)", subtitle:"ONG & projets sociaux", units:[
      "1) Hifil passÃ©/futur (coordonner)",
      "2) Piel prÃ©sent/passÃ© (enseigner)",
      "8) Projet Gimel â€“ Compte-rendu ONG"
    ]},
    { title:"Dalet (B1)", subtitle:"Gestion de groupe & mÃ©diation", units:[
      "1) Piel futur & Hitpael prÃ©sent",
      "3) Conditions & mÃ©diation",
      "8) Projet Dalet â€“ Briefing complet"
    ]},
    { title:"He (B1+)", subtitle:"Argumenter & Ã©crire pro", units:[
      "1) Presse facile & rÃ©sumÃ©",
      "4) Appels Ã  projets / rapports"
    ]},
    { title:"Vav (B2)", subtitle:"RÃ©unions & presse", units:[
      "1) DÃ©bat & nuance",
      "4) Lecture authentique"
    ]}
  ];

  const grid = document.getElementById('oulpanGrid');
  grid.innerHTML = OULPAN.map(block=>`
    <div class="card">
      <div class="month"><h2>${block.title} â€” ${block.subtitle}</h2>
        <div style="display:flex;gap:.4rem;align-items:center"><span class="badge">${block.units.length} modules</span><span class="pct">0%</span></div>
      </div>
      ${block.units.map((u,idx)=>`<details><summary><label class="progress"><input type="checkbox" class="cb" data-id="oulpan::${block.title}::${idx}"/> <span>${u}</span></label></summary>
        <div class="section">IA Boost</div>
        <div>
          <button class="copy" data-text="You're a Hebrew tutor. Build me a 5-week beginner-friendly learning plan to become conversational in Hebrew. Focus on everyday phrases, grammar, and pronunciation.">ğŸ Sprint 5 semaines</button>
          <button class="copy" data-text="Act like a patient Hebrew teacher. Explain this grammar concept in very simple terms with examples I can reuse: [insert concept].">ğŸˆ Comme si j'avais 10 ans</button>
          <button class="copy" data-text="You're my Hebrew coach. Give me a 5-question daily quiz based on beginner vocabulary/grammar. Then correct my answers and explain why.">ğŸ“… Quiz quotidien</button>
          <button class="copy" data-text="Translate these French sentences to Hebrew (no transliteration, no niqqud): [insert]. Then explain structure, grammar, and pronunciation tips.">ğŸ”„ Traduire en contexte</button>
          <button class="copy" data-text="Simulate a conversation at a youth center in Tel Aviv. Ask me questions, wait for my responses, then correct and guide me naturally.">ğŸ­ Conversation rÃ©elle</button>
          <button class="copy" data-text="Act like a Hebrew accountability coach. Give me a 15-minute daily routine and a motivational message to stay on track.">ğŸ”” Coach & routine</button>
        </div>
      </details>`).join('')}
      <div class="card-tools">
        <a class="btn small mark-card">Tout cocher</a>
        <a class="btn small unmark-card">Tout dÃ©cocher</a>
        <a class="btn small toggle-card">Ouvrir/Fermer tous</a>
      </div>
    </div>`).join('');

  // Copy helper
  document.querySelectorAll('.copy').forEach(btn=>{
    btn.addEventListener('click', async (e)=>{
      e.stopPropagation();
      try { await navigator.clipboard.writeText(btn.dataset.text);
        const prev = btn.textContent; btn.textContent="CopiÃ© âœ“"; btn.classList.add('copied');
        setTimeout(()=>{btn.textContent=prev; btn.classList.remove('copied');}, 1200);
      } catch(err){ alert('Copie impossible'); }
    });
  });

  // SRS demo list (placeholder)
  const srsList = document.getElementById('srsList');
  const srsCount = document.getElementById('srsCount');
  function renderSRS(items){ srsList.innerHTML = items.map(w=>`<li>${w}</li>`).join(''); srsCount.textContent = items.length + " cartes"; }
  document.getElementById('srsGenerate').addEventListener('click', ()=>{
    const sample = ["×©×œ×•×","×ª×•×“×”","×‘×‘×§×©×”","×× ×™","××ª×”","××ª","×× ×—× ×•","×‘×™×ª","×¢×‘×•×“×”","×‘×™×ª ×¡×¤×¨"];
    renderSRS(sample);
  });
  document.getElementById('srsClear').addEventListener('click', ()=> renderSRS([]));

  initChecklist(document.querySelector('main'), 'oulpan_progress');

  // Theme toggle with persistence
  (function(){
    const KEY='pref_theme';
    const btn = document.getElementById('themeToggle');
    function apply(t){ document.documentElement.setAttribute('data-theme', t); if(btn) btn.textContent = 'ThÃ¨me: ' + (t==='light'?'Clair':'Sombre'); }
    const saved = localStorage.getItem(KEY) || 'dark';
    apply(saved);
    btn?.addEventListener('click', ()=>{ const cur = document.documentElement.getAttribute('data-theme')||'dark'; const next = cur==='dark'?'light':'dark'; localStorage.setItem(KEY,next); apply(next); });
  })();


  // Local Notifications (ask permission once; simple reminders on load)
  async function askNotify(){
    try{
      if(!('Notification' in window)) return;
      if(Notification.permission === 'granted') return;
      if(Notification.permission !== 'denied'){
        await Notification.requestPermission();
      }
    }catch(e){}
  }
  function notifyNow(title, body){
    try{
      if(('Notification' in window) && Notification.permission === 'granted'){
        new Notification(title, { body });
      }
    }catch(e){}
  }
  // Heuristics: if it's Sunday and weekly goals not 100%, notify.
  function sundayNotifyCheck(){
    const isSunday = (new Date().getDay()) === 0;
    if(!isSunday) return;
    const keys = ['car_weekly','moto_weekly','guitar_weekly','dj_weekly','sport_weekly','oulpan_weekly','english_weekly','photo_weekly','ong_weekly'];
    let pending = 0;
    keys.forEach(k=>{
      try{
        const s = JSON.parse(localStorage.getItem(k)||'{}');
        const items = s.items||{};
        Object.keys(items).forEach(id=>{
          const presetTarget = 1; // we don't know target here; banner handles more detail; we just detect non-zero unfinished by pct bars; fallback simple heuristic:
        });
      }catch(e){}
    });
    // Lightweight ping (content details are on each page)
    notifyNow('Rappel hebdo', 'Pense Ã  complÃ©ter tes objectifs de la semaine.');
  }
  // Daily: if Oulpan SRS has due items, ping once per load
  function srsNotify(){
    try{
      const s = JSON.parse(localStorage.getItem('oulpan_srs_v1')||'{}');
      if(s.items){
        const today = new Date(); today.setHours(0,0,0,0);
        const due = Object.values(s.items).filter(it => !it.nextDue || new Date(it.nextDue).setHours(0,0,0,0) <= today).length;
        if(due>0) notifyNow('Oulpan â€” SRS', due + ' carte(s) Ã  rÃ©viser aujourdâ€™hui.');
      }
    }catch(e){}
  }
  askNotify().then(()=>{ sundayNotifyCheck(); srsNotify(); });

</script>

  
<script type="module">
  import {{ loadProgress, saveProgress }} from './assets/js/app.js';
  const KEY = 'oulpan_weekly';
  const PRESET = [{"id": "words", "title": "Cartes SRS rÃ©visÃ©es", "target": 60, "unit": "mots", "step2": 10}, {"id": "dialogues", "title": "Dialogues simulÃ©s", "target": 2, "unit": "dialogues"}];
  const list = document.getElementById('weeklyList');
  function monday(d){{ const dt=new Date(d); const day=(dt.getDay()+6)%7; dt.setDate(dt.getDate()-day); dt.setHours(0,0,0,0); return dt; }}
  function weekKey(){{ return monday(new Date()).toISOString().slice(0,10); }}
  function load(){{ let s=loadProgress(KEY); if(!s || s.week!==weekKey()) s={{week:weekKey(), items:Object.fromEntries(PRESET.map(p=>[p.id,0]))}}; return s; }}
  let STATE = load();
  function save(){{ saveProgress(KEY, STATE); render(); }}
  function render(){{ list.innerHTML = PRESET.map(p=>{{
      const val = STATE.items[p.id]||0;
      const pct = Math.min(100, Math.round(100*val/p.target));
      return `<li><strong>${{p.title}}</strong> â€” ${{val}} / ${{p.target}} ${{p.unit}}
        <div class='barwrap'><div class='bar' style='width:${{pct}}%'></div></div>
        <div class='links'><a class='btn small' data-inc='${{p.id}}'>+1</a>${{p.step2?` <a class='btn small' data-inc2='${{p.id}}'>+${{p.step2}}</a>`:''}</div></li>`;
    }}).join('');
    list.querySelectorAll('[data-inc]').forEach(b=> b.addEventListener('click', ()=>{{ const id=b.getAttribute('data-inc'); STATE.items[id]=(STATE.items[id]||0)+1; save(); }}));
    list.querySelectorAll('[data-inc2]').forEach(b=> b.addEventListener('click', ()=>{{ const id=b.getAttribute('data-inc2'); STATE.items[id]=(STATE.items[id]||0)+10; save(); }}));
  }}
  document.getElementById('weeklyReset')?.addEventListener('click', ()=>{{ STATE={{week:weekKey(), items:Object.fromEntries(PRESET.map(p=>[p.id,0]))}}; save(); }});
  if(STATE.week!==weekKey()){{ STATE={{week:weekKey(), items:Object.fromEntries(PRESET.map(p=>[p.id,0]))}}; save(); }}
  render();

  // Theme toggle with persistence
  (function(){
    const KEY='pref_theme';
    const btn = document.getElementById('themeToggle');
    function apply(t){ document.documentElement.setAttribute('data-theme', t); if(btn) btn.textContent = 'ThÃ¨me: ' + (t==='light'?'Clair':'Sombre'); }
    const saved = localStorage.getItem(KEY) || 'dark';
    apply(saved);
    btn?.addEventListener('click', ()=>{ const cur = document.documentElement.getAttribute('data-theme')||'dark'; const next = cur==='dark'?'light':'dark'; localStorage.setItem(KEY,next); apply(next); });
  })();


  // Local Notifications (ask permission once; simple reminders on load)
  async function askNotify(){
    try{
      if(!('Notification' in window)) return;
      if(Notification.permission === 'granted') return;
      if(Notification.permission !== 'denied'){
        await Notification.requestPermission();
      }
    }catch(e){}
  }
  function notifyNow(title, body){
    try{
      if(('Notification' in window) && Notification.permission === 'granted'){
        new Notification(title, { body });
      }
    }catch(e){}
  }
  // Heuristics: if it's Sunday and weekly goals not 100%, notify.
  function sundayNotifyCheck(){
    const isSunday = (new Date().getDay()) === 0;
    if(!isSunday) return;
    const keys = ['car_weekly','moto_weekly','guitar_weekly','dj_weekly','sport_weekly','oulpan_weekly','english_weekly','photo_weekly','ong_weekly'];
    let pending = 0;
    keys.forEach(k=>{
      try{
        const s = JSON.parse(localStorage.getItem(k)||'{}');
        const items = s.items||{};
        Object.keys(items).forEach(id=>{
          const presetTarget = 1; // we don't know target here; banner handles more detail; we just detect non-zero unfinished by pct bars; fallback simple heuristic:
        });
      }catch(e){}
    });
    // Lightweight ping (content details are on each page)
    notifyNow('Rappel hebdo', 'Pense Ã  complÃ©ter tes objectifs de la semaine.');
  }
  // Daily: if Oulpan SRS has due items, ping once per load
  function srsNotify(){
    try{
      const s = JSON.parse(localStorage.getItem('oulpan_srs_v1')||'{}');
      if(s.items){
        const today = new Date(); today.setHours(0,0,0,0);
        const due = Object.values(s.items).filter(it => !it.nextDue || new Date(it.nextDue).setHours(0,0,0,0) <= today).length;
        if(due>0) notifyNow('Oulpan â€” SRS', due + ' carte(s) Ã  rÃ©viser aujourdâ€™hui.');
      }
    }catch(e){}
  }
  askNotify().then(()=>{ sundayNotifyCheck(); srsNotify(); });

</script>


<script type="module">
  // Weekly reminder: if Sunday and objectives < 100%, show banner
  (function(){
    const isSunday = (new Date().getDay()) === 0; // 0=Sunday
    const list = document.getElementById('weeklyList');
    const banner = document.getElementById('weeklyBanner');
    const txt = document.getElementById('weeklyBannerText');
    if(!list || !banner || !txt) return;
    if(!isSunday){ banner.classList.add('hidden'); return; }
    const bars = list.querySelectorAll('.barwrap .bar');
    let allOk = true;
    bars.forEach(b=>{
      const w = parseInt(b.style.width||'0');
      if(w < 100) allOk = false;
    });
    if(allOk){
      banner.style.borderColor = '#34d399';
      txt.textContent = 'âœ… Objectifs hebdo atteints. Bravo !';
    }else{
      banner.style.borderColor = '#f59e0b';
      txt.textContent = 'â° Il reste des objectifs Ã  complÃ©ter cette semaine.';
    }
  })();

  // Theme toggle with persistence
  (function(){
    const KEY='pref_theme';
    const btn = document.getElementById('themeToggle');
    function apply(t){ document.documentElement.setAttribute('data-theme', t); if(btn) btn.textContent = 'ThÃ¨me: ' + (t==='light'?'Clair':'Sombre'); }
    const saved = localStorage.getItem(KEY) || 'dark';
    apply(saved);
    btn?.addEventListener('click', ()=>{ const cur = document.documentElement.getAttribute('data-theme')||'dark'; const next = cur==='dark'?'light':'dark'; localStorage.setItem(KEY,next); apply(next); });
  })();


  // Local Notifications (ask permission once; simple reminders on load)
  async function askNotify(){
    try{
      if(!('Notification' in window)) return;
      if(Notification.permission === 'granted') return;
      if(Notification.permission !== 'denied'){
        await Notification.requestPermission();
      }
    }catch(e){}
  }
  function notifyNow(title, body){
    try{
      if(('Notification' in window) && Notification.permission === 'granted'){
        new Notification(title, { body });
      }
    }catch(e){}
  }
  // Heuristics: if it's Sunday and weekly goals not 100%, notify.
  function sundayNotifyCheck(){
    const isSunday = (new Date().getDay()) === 0;
    if(!isSunday) return;
    const keys = ['car_weekly','moto_weekly','guitar_weekly','dj_weekly','sport_weekly','oulpan_weekly','english_weekly','photo_weekly','ong_weekly'];
    let pending = 0;
    keys.forEach(k=>{
      try{
        const s = JSON.parse(localStorage.getItem(k)||'{}');
        const items = s.items||{};
        Object.keys(items).forEach(id=>{
          const presetTarget = 1; // we don't know target here; banner handles more detail; we just detect non-zero unfinished by pct bars; fallback simple heuristic:
        });
      }catch(e){}
    });
    // Lightweight ping (content details are on each page)
    notifyNow('Rappel hebdo', 'Pense Ã  complÃ©ter tes objectifs de la semaine.');
  }
  // Daily: if Oulpan SRS has due items, ping once per load
  function srsNotify(){
    try{
      const s = JSON.parse(localStorage.getItem('oulpan_srs_v1')||'{}');
      if(s.items){
        const today = new Date(); today.setHours(0,0,0,0);
        const due = Object.values(s.items).filter(it => !it.nextDue || new Date(it.nextDue).setHours(0,0,0,0) <= today).length;
        if(due>0) notifyNow('Oulpan â€” SRS', due + ' carte(s) Ã  rÃ©viser aujourdâ€™hui.');
      }
    }catch(e){}
  }
  askNotify().then(()=>{ sundayNotifyCheck(); srsNotify(); });

</script>

</main>
  <footer>ConÃ§u pour Ruben â€¢ Â© 2025</footer>
  <script type="module">
    import { setActiveNav, exportAllCSV } from './assets/js/app.js';
    setActiveNav('oulpan.html');
    document.getElementById('exportCSV').addEventListener('click', ()=>{
      exportAllCSV('progression.csv',[
        {key:'edu_progress', label:'Education'},
        {key:'oulpan_progress', label:'Oulpan'},
        {key:'vae_progress', label:'VAE'},
        {key:'master_progress', label:'Master'},
        {key:'ong_progress', label:'ONG'},
        {key:'sport_progress', label:'Sport'},
        {key:'english_progress', label:'English'},
        {key:'car_progress', label:'Permis voiture'},
        {key:'moto_progress', label:'Permis moto'},
        {key:'photo_progress', label:'Photo'},
        {key:'guitar_progress', label:'Guitare'},
        {key:'dj_progress', label:'DJ'}
      ]);
    });
  
  // Theme toggle with persistence
  (function(){
    const KEY='pref_theme';
    const btn = document.getElementById('themeToggle');
    function apply(t){ document.documentElement.setAttribute('data-theme', t); if(btn) btn.textContent = 'ThÃ¨me: ' + (t==='light'?'Clair':'Sombre'); }
    const saved = localStorage.getItem(KEY) || 'dark';
    apply(saved);
    btn?.addEventListener('click', ()=>{ const cur = document.documentElement.getAttribute('data-theme')||'dark'; const next = cur==='dark'?'light':'dark'; localStorage.setItem(KEY,next); apply(next); });
  })();


  // Local Notifications (ask permission once; simple reminders on load)
  async function askNotify(){
    try{
      if(!('Notification' in window)) return;
      if(Notification.permission === 'granted') return;
      if(Notification.permission !== 'denied'){
        await Notification.requestPermission();
      }
    }catch(e){}
  }
  function notifyNow(title, body){
    try{
      if(('Notification' in window) && Notification.permission === 'granted'){
        new Notification(title, { body });
      }
    }catch(e){}
  }
  // Heuristics: if it's Sunday and weekly goals not 100%, notify.
  function sundayNotifyCheck(){
    const isSunday = (new Date().getDay()) === 0;
    if(!isSunday) return;
    const keys = ['car_weekly','moto_weekly','guitar_weekly','dj_weekly','sport_weekly','oulpan_weekly','english_weekly','photo_weekly','ong_weekly'];
    let pending = 0;
    keys.forEach(k=>{
      try{
        const s = JSON.parse(localStorage.getItem(k)||'{}');
        const items = s.items||{};
        Object.keys(items).forEach(id=>{
          const presetTarget = 1; // we don't know target here; banner handles more detail; we just detect non-zero unfinished by pct bars; fallback simple heuristic:
        });
      }catch(e){}
    });
    // Lightweight ping (content details are on each page)
    notifyNow('Rappel hebdo', 'Pense Ã  complÃ©ter tes objectifs de la semaine.');
  }
  // Daily: if Oulpan SRS has due items, ping once per load
  function srsNotify(){
    try{
      const s = JSON.parse(localStorage.getItem('oulpan_srs_v1')||'{}');
      if(s.items){
        const today = new Date(); today.setHours(0,0,0,0);
        const due = Object.values(s.items).filter(it => !it.nextDue || new Date(it.nextDue).setHours(0,0,0,0) <= today).length;
        if(due>0) notifyNow('Oulpan â€” SRS', due + ' carte(s) Ã  rÃ©viser aujourdâ€™hui.');
      }
    }catch(e){}
  }
  askNotify().then(()=>{ sundayNotifyCheck(); srsNotify(); });

</script>
  

<script type="module">
  // Simple JSON editor for Oulpan wordlists
  const TA = document.getElementById('wordsJson');
  const OVK = 'oulpan_words_override';
  async function loadFile(){
    try{
      const res = await fetch('assets/data/oulpan_words.json');
      const data = await res.json();
      const override = localStorage.getItem(OVK);
      TA.value = override ? override : JSON.stringify(data, null, 2);
    }catch(e){
      TA.value = localStorage.getItem(OVK) || '{"education":[],"ong":[],"admin":[]}';
    }
  }
  function saveOverride(){
    try{
      const obj = JSON.parse(TA.value);
      localStorage.setItem(OVK, JSON.stringify(obj));
      alert('SauvegardÃ© localement. Le SRS rechargera ces listes.');
    }catch(e){
      alert('JSON invalide : ' + e.message);
    }
  }
  function resetOverride(){
    localStorage.removeItem(OVK);
    loadFile();
    alert('Override supprimÃ©. Retour au fichier par dÃ©faut.');
  }
  function downloadJson(){
    const blob = new Blob([TA.value], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'oulpan_words.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
  }
  document.getElementById('loadFile').addEventListener('click', loadFile);
  document.getElementById('saveOverride').addEventListener('click', saveOverride);
  document.getElementById('resetOverride').addEventListener('click', resetOverride);
  document.getElementById('downloadJson').addEventListener('click', downloadJson);
  loadFile();

  // Import local JSON file
  const fileInput = document.getElementById('jsonFileInput');
  fileInput.addEventListener('change', async (e)=>{
    const f = e.target.files[0];
    if(!f) return;
    const text = await f.text();
    try{
      const obj = JSON.parse(text);
      TA.value = JSON.stringify(obj, null, 2);
      alert('Fichier chargÃ©. Clique â€œSauvegarder (local)â€ pour lâ€™utiliser dans le SRS.');
    }catch(err){
      alert('JSON invalide : ' + err.message);
    }
  });


  // Theme toggle with persistence
  (function(){
    const KEY='pref_theme';
    const btn = document.getElementById('themeToggle');
    function apply(t){ document.documentElement.setAttribute('data-theme', t); if(btn) btn.textContent = 'ThÃ¨me: ' + (t==='light'?'Clair':'Sombre'); }
    const saved = localStorage.getItem(KEY) || 'dark';
    apply(saved);
    btn?.addEventListener('click', ()=>{ const cur = document.documentElement.getAttribute('data-theme')||'dark'; const next = cur==='dark'?'light':'dark'; localStorage.setItem(KEY,next); apply(next); });
  })();


  // Local Notifications (ask permission once; simple reminders on load)
  async function askNotify(){
    try{
      if(!('Notification' in window)) return;
      if(Notification.permission === 'granted') return;
      if(Notification.permission !== 'denied'){
        await Notification.requestPermission();
      }
    }catch(e){}
  }
  function notifyNow(title, body){
    try{
      if(('Notification' in window) && Notification.permission === 'granted'){
        new Notification(title, { body });
      }
    }catch(e){}
  }
  // Heuristics: if it's Sunday and weekly goals not 100%, notify.
  function sundayNotifyCheck(){
    const isSunday = (new Date().getDay()) === 0;
    if(!isSunday) return;
    const keys = ['car_weekly','moto_weekly','guitar_weekly','dj_weekly','sport_weekly','oulpan_weekly','english_weekly','photo_weekly','ong_weekly'];
    let pending = 0;
    keys.forEach(k=>{
      try{
        const s = JSON.parse(localStorage.getItem(k)||'{}');
        const items = s.items||{};
        Object.keys(items).forEach(id=>{
          const presetTarget = 1; // we don't know target here; banner handles more detail; we just detect non-zero unfinished by pct bars; fallback simple heuristic:
        });
      }catch(e){}
    });
    // Lightweight ping (content details are on each page)
    notifyNow('Rappel hebdo', 'Pense Ã  complÃ©ter tes objectifs de la semaine.');
  }
  // Daily: if Oulpan SRS has due items, ping once per load
  function srsNotify(){
    try{
      const s = JSON.parse(localStorage.getItem('oulpan_srs_v1')||'{}');
      if(s.items){
        const today = new Date(); today.setHours(0,0,0,0);
        const due = Object.values(s.items).filter(it => !it.nextDue || new Date(it.nextDue).setHours(0,0,0,0) <= today).length;
        if(due>0) notifyNow('Oulpan â€” SRS', due + ' carte(s) Ã  rÃ©viser aujourdâ€™hui.');
      }
    }catch(e){}
  }
  askNotify().then(()=>{ sundayNotifyCheck(); srsNotify(); });

</script>

</body>
</html>